web:
  image: dockerfile/java:oracle-java8
  working_dir: /app/web
  command: ./gradlew clean bootRun --project-cache-dir /app/web
  environment:
    GRADLE_OPTS: "-Dgradle.user.home=/app/.user_gradle"
  volumes:
    - web/:/app/web/
    - ~/.gradle:/app/.user_gradle
  ports:
    - 9191:9191
    - 9192:9192
  links:
    - rabbitmq

varnish:
  image: million12/varnish
  volumes:
    - ./conf/:/varnish/conf
  environment:
    VCL_CONFIG: "/varnish/conf/varnish.vcl"
  links:
    - web
  ports:
    - 80:80

nginx:
  image: dockerfile/nginx
  ports:
    - 9090:80
  volumes:
    - ./logs/:/var/log/nginx
  links:
    - varnish
    - rabbitmq

rabbitmq:
  image: rabbitmq:management
  ports:
    - 5672:5672
    - 15672:15672
